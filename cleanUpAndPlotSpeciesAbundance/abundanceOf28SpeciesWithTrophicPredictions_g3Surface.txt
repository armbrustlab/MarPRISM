###G3 surface
 
R

#load estimated counts for taxa across g3 surface samples
#from prepareFilesForModel_g3Surface.txt
> g3_gather_merged <- read_csv("~/g3/G3_allSamples_processed_updatedMarferret_marmicroDb2023_noOutliers_fall2023.csv")

#load names of 28 species bins that received trophic mode predictions 
#across G1-G3 surface transects, G3 depth profiles, G2 incubations, 
#aloha diel, and g3 diel
#from plotAllTrophicModePredictions.R
> species <- read_csv("~/28SpeciesWithTrophicPredictions.csv")

#load taxa names corresponding to taxa ids in marferret
> name <- read_csv("/mnt/nfs/projects/marferret/v1/data/MarFERReT.v1.taxa.csv")

#get rid of unnecessary variables
> name <- name %>% select(1:4)

#add taxa names to counts data
> nrow(g3_gather_merged)
[1] 125540927
> g3_gather_merged_name <- g3_gather_merged %>% left_join(name, by = c("V2" = "tax_id"))
> nrow(g3_gather_merged_name)
[1] 125540927

#get counts for the taxa without trophic predictions
> notOfInt <- g3_gather_merged_name %>% anti_join(species, by = c("tax_name" = "taxa"))

#get total estimated counts by sample and taxa for the taxa without 
#trophic predictions
> notOfInt_summary <- notOfInt %>% group_by(tax_name, sample) %>% summarize(est_counts = sum(est_counts))
`summarise()` has grouped output by 'tax_name'. You can override using the `.groups` argument.

> notOfInt_summary %>% write_csv("~/g3/G3PA.contig_dat_all_otherThanSpeciesWithTrophicPredictions_summary_updatedMarferret_marmicroDb2023_noOutliers_fall2023_28.csv")

#gets rid of counts without taxa annotations
> g3_gather_merged_name_noMissingTaxa <- g3_gather_merged_name %>% filter(!is.na(tax_name))

#get counts for the 28 species with trophic predictions
> ofInt <- g3_gather_merged_name_noMissingTaxa %>% semi_join(species, by = c("tax_name" = "taxa"))

#get total estimated counts by sample and taxa for the 28 species with 
#trophic predictions
> ofInt_summary <- ofInt %>% group_by(tax_name, sample) %>% summarize(est_counts = sum(est_counts))
`summarise()` has grouped output by 'tax_name'. You can override using the `.groups` argument.

> ofInt_summary %>% write_csv("~/g3/G3PA.contig_dat_all_speciesWithTrophicPredictions_summary_updatedMarferret_marmicroDb2023_noOutliers_fall2023_28.csv")
