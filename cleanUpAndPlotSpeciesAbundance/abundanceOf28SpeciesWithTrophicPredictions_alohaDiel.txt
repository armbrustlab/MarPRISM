###aloha diel 

R

#load estimated counts for taxa across aloha diel samples
#from prepareFilesForModel_alohaDiel.txt
> aloha <- read_csv("~/alohaDiel/aloha_diel_allSamples_processed_updatedMarferret_marmicroDb2023_noOutliers_fall2023.csv")

#load names of 28 species bins that received trophic mode predictions 
#across G1-G3 surface transects, G3 depth profiles, G2 incubations, 
#aloha diel, and g3 diel
#from plotAllTrophicModePredictions.R
> species <- read_csv("~/28SpeciesWithTrophicPredictions.csv")

#load taxa names corresponding to taxa ids in marferret
> name <- read_csv("/mnt/nfs/projects/marferret/v1/data/MarFERReT.v1.taxa.csv")

#get rid of unnecessary variables
> name <- name %>% select(1:4)

#rename tax id variable
> colnames(aloha)[4] <- "tax_id"

#add taxa names to counts data
> nrow(aloha)
> aloha <- aloha %>% left_join(name, by = c("tax_id"))
> nrow(aloha)
[1] 154298831

#get counts for the 28 species with trophic predictions
> ofIntSummary <- aloha %>% semi_join(species, by = c("tax_name" = "taxa"))

#get counts for the taxa without trophic predictions 
> notOfInt <- aloha %>% anti_join(species, by = c("tax_name"  = "taxa"))

#get total estimated counts by sample and taxa for the 28 species with 
#trophic predictions
> ofIntSummary <- ofIntSummary %>% group_by(tax_name, sample) %>% summarize(est_counts = sum(est_counts))
`summarise()` has grouped output by 'tax_name'. You can override using the `.groups` argument.

#get total estimated counts by sample and taxa for the taxa without 
#trophic predictions
> notOfIntSummary <- notOfInt %>% group_by(tax_name, sample) %>% summarize(est_counts = sum(est_counts))
`summarise()` has grouped output by 'tax_name'. You can override using the `.groups` argument.

> ofIntSummary %>% write_csv("~/alohaDiel/G1_diel_allSamples_processed_updatedMarferret_marmicroDb2023_noOutliers_speciesWithTrophicPredictions_fall2023_28.csv")

#exclude counts that were not identified to a taxa 
> notOfIntSummary %>% filter(!is.na(tax_name)) %>% write_csv("~/alohaDiel/G1_diel_allSamples_processed_updatedMarferret_marmicroDb2023_noOutliers_otherThanSpeciesWithTrophicPredictions_fall2023_28.csv")
