###g2 incubations

R

#load estimated counts for taxa across aloha diel samples
#from prepareFilesForModel_g2Incubations.txt
> g2Inc <- read_csv("~/g2Incubations/g2Inc_taxa_pfams.csv")

#load names of 28 species bins that received trophic mode predictions 
#across G1-G3 surface transects, G3 depth profiles, G2 incubations, 
#aloha diel, and g3 diel
#from plotAllTrophicModePredictions.R
> species <- read_csv("~/28SpeciesWithTrophicPredictions.csv")

#load taxa names corresponding to taxa ids in marferret
> name <- read_csv("/mnt/nfs/projects/marferret/v1/data/MarFERReT.v1.taxa.csv")

#get rid of unnecessary variables
> name <- name %>% select(1:4)

#add taxa names to counts data
> nrow(g2Inc)
[1] 140625859
> g2Inc <- g2Inc %>% left_join(name, by = c("V2" = "tax_id"))
> nrow(g2Inc)
[1] 140625859

#get counts for the taxa without trophic predictions 
> notOfInt <- g2Inc %>% anti_join(species, by = c("tax_name" = "taxa"))

#get total estimated counts by sample and taxa for the taxa without 
#trophic predictions
> notOfInt_summary <- notOfInt %>% group_by(tax_name, sample) %>% summarize(est_counts = sum(est_counts))
`summarise()` has grouped output by 'tax_name'. You can override using the `.groups` argument.

> notOfInt_summary %>% write_csv("~/g2Incubations/g2Inc_notOfInt_28.csv")

#gets rid of counts without taxa annotations
> g2Inc <- g2Inc %>% filter(!is.na(tax_name))

#get counts for the 28 species with trophic predictions
> ofInt <- g2Inc %>% semi_join(species, by = c("tax_name" = "taxa"))

#get total estimated counts by sample and taxa for the 28 species with 
#trophic predictions
> ofInt_summary <- ofInt %>% group_by(tax_name, sample) %>% summarize(est_counts = sum(est_counts))
`summarise()` has grouped output by 'tax_name'. You can override using the `.groups` argument.

> ofInt_summary %>% write_csv("~/g2Incubations/g2Inc_ofInt_28.csv")
